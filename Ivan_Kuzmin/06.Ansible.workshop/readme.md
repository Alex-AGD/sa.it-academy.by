# **05.Ansible.worksop**
## **Result**
```bash
root@ubuntu:~/06.ansible.workshop# ansible-playbook -i inv.yaml dz.yaml

PLAY [db_all] ***************************************************************************************************************************************************************

TASK [Gathering Facts] ******************************************************************************************************************************************************
Monday 06 March 2023  13:38:15 +0000 (0:00:00.013)       0:00:00.013 **********
ok: [host10]

TASK [Apt update Install Nginx] *********************************************************************************************************************************************
Monday 06 March 2023  13:38:17 +0000 (0:00:01.783)       0:00:01.797 **********
ok: [host10]

TASK [mkdir site1] **********************************************************************************************************************************************************
Monday 06 March 2023  13:38:20 +0000 (0:00:02.884)       0:00:04.681 **********
ok: [host10]

TASK [mkdir site2] **********************************************************************************************************************************************************
Monday 06 March 2023  13:38:20 +0000 (0:00:00.814)       0:00:05.496 **********
ok: [host10]

TASK [make html for site1] **************************************************************************************************************************************************
Monday 06 March 2023  13:38:21 +0000 (0:00:00.706)       0:00:06.203 **********
ok: [host10]

TASK [make html for site2] **************************************************************************************************************************************************
Monday 06 March 2023  13:38:22 +0000 (0:00:01.229)       0:00:07.432 **********
ok: [host10]

TASK [mkdir site1] **********************************************************************************************************************************************************
Monday 06 March 2023  13:38:24 +0000 (0:00:01.175)       0:00:08.608 **********
ok: [host10]

TASK [mkdir site2] **********************************************************************************************************************************************************
Monday 06 March 2023  13:38:24 +0000 (0:00:00.680)       0:00:09.288 **********
ok: [host10]

TASK [add config site1] *****************************************************************************************************************************************************
Monday 06 March 2023  13:38:25 +0000 (0:00:00.660)       0:00:09.949 **********
ok: [host10]

TASK [add config site2] *****************************************************************************************************************************************************
Monday 06 March 2023  13:38:26 +0000 (0:00:01.069)       0:00:11.018 **********
ok: [host10]

TASK [Add sites in hosts] ***************************************************************************************************************************************************
Monday 06 March 2023  13:38:27 +0000 (0:00:01.109)       0:00:12.128 **********
changed: [host10]

TASK [symbolic link site1] **************************************************************************************************************************************************
Monday 06 March 2023  13:38:28 +0000 (0:00:00.848)       0:00:12.977 **********
ok: [host10]

TASK [symbolic link site2] **************************************************************************************************************************************************
Monday 06 March 2023  13:38:29 +0000 (0:00:00.728)       0:00:13.705 **********
ok: [host10]

TASK [Check1] ***************************************************************************************************************************************************************
Monday 06 March 2023  13:38:30 +0000 (0:00:01.660)       0:00:15.365 **********
ok: [host10]

TASK [Check2] ***************************************************************************************************************************************************************
Monday 06 March 2023  13:38:32 +0000 (0:00:01.572)       0:00:16.938 **********
ok: [host10]

PLAY RECAP ******************************************************************************************************************************************************************
host10                     : ok=15   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

Monday 06 March 2023  13:38:33 +0000 (0:00:00.771)       0:00:17.710 **********
===============================================================================
Apt update Install Nginx --------------------------------------------------------------------------------------------------------------------------------------------- 2.88s
Gathering Facts ------------------------------------------------------------------------------------------------------------------------------------------------------ 1.78s
symbolic link site2 -------------------------------------------------------------------------------------------------------------------------------------------------- 1.66s
Check1 --------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.57s
make html for site1 -------------------------------------------------------------------------------------------------------------------------------------------------- 1.23s
make html for site2 -------------------------------------------------------------------------------------------------------------------------------------------------- 1.18s
add config site2 ----------------------------------------------------------------------------------------------------------------------------------------------------- 1.11s
add config site1 ----------------------------------------------------------------------------------------------------------------------------------------------------- 1.07s
Add sites in hosts --------------------------------------------------------------------------------------------------------------------------------------------------- 0.85s
mkdir site1 ---------------------------------------------------------------------------------------------------------------------------------------------------------- 0.81s
Check2 --------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.77s
symbolic link site1 -------------------------------------------------------------------------------------------------------------------------------------------------- 0.73s
mkdir site2 ---------------------------------------------------------------------------------------------------------------------------------------------------------- 0.71s
mkdir site1 ---------------------------------------------------------------------------------------------------------------------------------------------------------- 0.68s
mkdir site2 ---------------------------------------------------------------------------------------------------------------------------------------------------------- 0.66s
Playbook run took 0 days, 0 hours, 0 minutes, 17 seconds
```
### **Playbook**
```bash
- hosts: db_all
  become: yes
  tasks:
    - name: Apt update Install Nginx
      apt:
        name: nginx
        state: latest
        update_cache: yes
    - name: mkdir site1
      ansible.builtin.file:
        path: /var/www/site1/html
        state: directory
        mode: '0755'
    - name: mkdir site2
      ansible.builtin.file:
        path: /var/www/site2/html
        state: directory
        mode: '0755'
    - name: make html for site1
      ansible.builtin.template:
          src: template1.html
          dest: /var/www/site1/html/site1.html
          owner: root
          group: root
          mode: '0755'
    - name: make html for site2
      ansible.builtin.template:
        src: template2.html
        dest: /var/www/site2/html/site2.html
        owner: root
        group: root
        mode: '0755'
    - name:  mkdir site1
      ansible.builtin.file:
        path: /etc/nginx/sites-available/site1
        state: directory
        mode: '0755'
    - name: mkdir site2
      ansible.builtin.file:
        path: /etc/nginx/sites-available/site2
        state: directory
        mode: '0755'       
    - name: add config site1
      ansible.builtin.template:
        src: virthost1.conf
        dest: /etc/nginx/sites-available/site1/site1.conf
        owner: root
        group: root
        mode: '0755'
    - name: add config site2
      ansible.builtin.template:
        src: virthost2.conf
        dest: /etc/nginx/sites-available/site1/site2.conf
        owner: root
        group: root
        mode: '0755'
    - name: Add sites in hosts
      ansible.builtin.shell:
        # cmd: echo "127.0.0.1 site1 site2 www.site1  www.site2"  >> /etc/hosts;
        cmd: grep -q site1  /etc/hosts || echo "127.0.0.1 site1 www.site1 site2 www.site2" >> /etc/hosts;   
    - name: symbolic link site1
      ansible.builtin.file:
        src: /etc/nginx/sites-available/site1
        dest: /etc/nginx/sites-enabled/site1
        state: link
    - name: symbolic link site2
      ansible.builtin.file:
        src: /etc/nginx/sites-available/site2
        dest: /etc/nginx/sites-enabled/site2
        state: link
    - name: Check1
      ansible.builtin.uri:
        url: http://www.site1
        return_content: true
    - name: Check2
      ansible.builtin.uri:
        url: http://www.site2
        return_content: true
```