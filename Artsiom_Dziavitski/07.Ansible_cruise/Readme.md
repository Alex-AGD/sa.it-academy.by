#07.Ansible cruise

## Tests
```bash
ansible-playbook test.yaml -i host_list.yaml 

PLAY [all_workers] ***********************************************************************************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:02:50 +0300 (0:00:00.068)       0:00:00.068 ********** 
ok: [host1]
ok: [host2]

TASK [test : Check SUDO with NOPASSWD] ***************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:02:52 +0300 (0:00:01.871)       0:00:01.939 ********** 
ok: [host1]
ok: [host2]

TASK [test : Check access to repositories] ***********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:02:53 +0300 (0:00:00.880)       0:00:02.820 ********** 
ok: [host1] => (item=http://debian.mur.at/debian/)
ok: [host2] => (item=http://debian.mur.at/debian/)
ok: [host1] => (item=http://mirror.centos.org/)
ok: [host2] => (item=http://mirror.centos.org/)
ok: [host2] => (item=https://pypi.org/)
ok: [host1] => (item=https://pypi.org/)

TASK [test : Check access to the Docker Hub] *********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:02:59 +0300 (0:00:05.408)       0:00:08.228 ********** 
ok: [host1]
ok: [host2]

TASK [test : Check disk space] ***********************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:03:00 +0300 (0:00:01.633)       0:00:09.862 ********** 
ok: [host1] => (item={'block_used': 457585, 'uuid': 'N/A', 'size_total': 21003583488, 'block_total': 5127828, 'mount': '/', 'block_available': 4670243, 'size_available': 19129315328, 'fstype': 'ext4', 'inode_total': 1310720, 'options': 'rw,relatime', 'device': '/dev/loop18', 'inode_used': 22733, 'block_size': 4096, 'inode_available': 1287987}) => {
    "ansible_loop_var": "item",
    "changed": false,
    "item": {
        "block_available": 4670243,
        "block_size": 4096,
        "block_total": 5127828,
        "block_used": 457585,
        "device": "/dev/loop18",
        "fstype": "ext4",
        "inode_available": 1287987,
        "inode_total": 1310720,
        "inode_used": 22733,
        "mount": "/",
        "options": "rw,relatime",
        "size_available": 19129315328,
        "size_total": 21003583488,
        "uuid": "N/A"
    },
    "msg": "All assertions passed"
}
ok: [host2] => (item={'mount': '/', 'device': '/dev/loop19', 'fstype': 'ext4', 'options': 'rw,relatime', 'size_total': 21003583488, 'size_available': 18817941504, 'block_size': 4096, 'block_total': 5127828, 'block_available': 4594224, 'block_used': 533604, 'inode_total': 1310720, 'inode_available': 1284162, 'inode_used': 26558, 'uuid': 'N/A'}) => {
    "ansible_loop_var": "item",
    "changed": false,
    "item": {
        "block_available": 4594224,
        "block_size": 4096,
        "block_total": 5127828,
        "block_used": 533604,
        "device": "/dev/loop19",
        "fstype": "ext4",
        "inode_available": 1284162,
        "inode_total": 1310720,
        "inode_used": 26558,
        "mount": "/",
        "options": "rw,relatime",
        "size_available": 18817941504,
        "size_total": 21003583488,
        "uuid": "N/A"
    },
    "msg": "All assertions passed"
}

TASK [test : RAM] ************************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:03:00 +0300 (0:00:00.145)       0:00:10.008 ********** 
ok: [host1] => (item={'block_used': 457585, 'uuid': 'N/A', 'size_total': 21003583488, 'block_total': 5127828, 'mount': '/', 'block_available': 4670243, 'size_available': 19129315328, 'fstype': 'ext4', 'inode_total': 1310720, 'options': 'rw,relatime', 'device': '/dev/loop18', 'inode_used': 22733, 'block_size': 4096, 'inode_available': 1287987}) => {
    "ansible_loop_var": "item",
    "changed": false,
    "item": {
        "block_available": 4670243,
        "block_size": 4096,
        "block_total": 5127828,
        "block_used": 457585,
        "device": "/dev/loop18",
        "fstype": "ext4",
        "inode_available": 1287987,
        "inode_total": 1310720,
        "inode_used": 22733,
        "mount": "/",
        "options": "rw,relatime",
        "size_available": 19129315328,
        "size_total": 21003583488,
        "uuid": "N/A"
    },
    "msg": "All assertions passed"
}
ok: [host2] => (item={'mount': '/', 'device': '/dev/loop19', 'fstype': 'ext4', 'options': 'rw,relatime', 'size_total': 21003583488, 'size_available': 18817941504, 'block_size': 4096, 'block_total': 5127828, 'block_available': 4594224, 'block_used': 533604, 'inode_total': 1310720, 'inode_available': 1284162, 'inode_used': 26558, 'uuid': 'N/A'}) => {
    "ansible_loop_var": "item",
    "changed": false,
    "item": {
        "block_available": 4594224,
        "block_size": 4096,
        "block_total": 5127828,
        "block_used": 533604,
        "device": "/dev/loop19",
        "fstype": "ext4",
        "inode_available": 1284162,
        "inode_total": 1310720,
        "inode_used": 26558,
        "mount": "/",
        "options": "rw,relatime",
        "size_available": 18817941504,
        "size_total": 21003583488,
        "uuid": "N/A"
    },
    "msg": "All assertions passed"
}

PLAY RECAP *******************************************************************************************************************************************************************************************************
host1                      : ok=6    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
host2                      : ok=6    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Tuesday 14 June 2022  04:03:00 +0300 (0:00:00.165)       0:00:10.173 ********** 
=============================================================================== 
test : Check access to repositories ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- 5.41s
Gathering Facts ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.87s
test : Check access to the Docker Hub --------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.63s
test : Check SUDO with NOPASSWD --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.88s
test : RAM ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 0.17s
test : Check disk space ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.15s
```


##Webserver
```bash
ansible-playbook web.yaml -i host_list.yaml 
PLAY [all_workers] ***********************************************************************************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:05 +0300 (0:00:00.143)       0:00:00.143 ********** 
ok: [host1]
ok: [host2]

TASK [webserver : Debian] ****************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:08 +0300 (0:00:02.845)       0:00:02.988 ********** 
skipping: [host1]
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/nginx_ubuntu.yaml for host2

TASK [webserver : Nginx. Install packages] ***********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:08 +0300 (0:00:00.304)       0:00:03.293 ********** 
ok: [host2]

TASK [webserver : Nginx. Enable and start service] ***************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:11 +0300 (0:00:02.844)       0:00:06.138 ********** 
ok: [host2]

TASK [webserver : Nginx. Deploy ubuntu] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:12 +0300 (0:00:01.392)       0:00:07.531 ********** 
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/deploy.yaml for host2
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/deploy.yaml for host2

TASK [webserver : Test destination dir] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:12 +0300 (0:00:00.154)       0:00:07.686 ********** 
ok: [host2]

TASK [webserver : Add index.html] ********************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:13 +0300 (0:00:01.065)       0:00:08.752 ********** 
ok: [host2]

TASK [webserver : Add conf] **************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:15 +0300 (0:00:01.634)       0:00:10.386 ********** 
ok: [host2]

TASK [webserver : Debug] *****************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:17 +0300 (0:00:01.826)       0:00:12.213 ********** 
ok: [host2] => {
    "msg": "Virtual host: ubuntu-main.site"
}

TASK [webserver : Test destination dir] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:17 +0300 (0:00:00.173)       0:00:12.386 ********** 
ok: [host2]

TASK [webserver : Add index.html] ********************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:18 +0300 (0:00:00.876)       0:00:13.262 ********** 
ok: [host2]

TASK [webserver : Add conf] **************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:19 +0300 (0:00:01.369)       0:00:14.632 ********** 
ok: [host2]

TASK [webserver : Debug] *****************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:21 +0300 (0:00:01.317)       0:00:15.950 ********** 
ok: [host2] => {
    "msg": "Virtual host: ubuntu-old.site"
}

TASK [webserver : Restart nginx ubuntu] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:21 +0300 (0:00:00.047)       0:00:15.997 ********** 
changed: [host2]

TASK [webserver : Nginx. Test ubuntu] ****************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:22 +0300 (0:00:01.192)       0:00:17.189 ********** 
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/test.yaml for host2
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/test.yaml for host2

TASK [webserver : Check content to the sites] ********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:22 +0300 (0:00:00.111)       0:00:17.300 ********** 
ok: [host2]

TASK [webserver : Debug test] ************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:23 +0300 (0:00:00.905)       0:00:18.206 ********** 
ok: [host2] => {
    "msg": "Virtual host: ubuntu-main.site"
}

TASK [webserver : Check content to the sites] ********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:23 +0300 (0:00:00.048)       0:00:18.254 ********** 
ok: [host2]

TASK [webserver : Debug test] ************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:24 +0300 (0:00:00.918)       0:00:19.173 ********** 
ok: [host2] => {
    "msg": "Virtual host: ubuntu-old.site"
}

TASK [webserver : CentOS] ****************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:24 +0300 (0:00:00.044)       0:00:19.217 ********** 
skipping: [host2]
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/nginx_centos.yaml for host1

TASK [webserver : Install EPEL Repo] *****************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:24 +0300 (0:00:00.094)       0:00:19.311 ********** 
ok: [host1]

TASK [webserver : Nginx. Install packages] ***********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:25 +0300 (0:00:01.149)       0:00:20.461 ********** 
ok: [host1]

TASK [webserver : Nginx. Enable and start service] ***************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:26 +0300 (0:00:01.046)       0:00:21.507 ********** 
ok: [host1]

TASK [webserver : Nginx. Deploy centos] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:27 +0300 (0:00:00.881)       0:00:22.388 ********** 
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/deploy.yaml for host1
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/deploy.yaml for host1

TASK [webserver : Test destination dir] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:27 +0300 (0:00:00.071)       0:00:22.459 ********** 
ok: [host1]

TASK [webserver : Add index.html] ********************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:28 +0300 (0:00:00.874)       0:00:23.334 ********** 
ok: [host1]

TASK [webserver : Add conf] **************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:29 +0300 (0:00:01.294)       0:00:24.628 ********** 
ok: [host1]

TASK [webserver : Debug] *****************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:31 +0300 (0:00:01.299)       0:00:25.927 ********** 
ok: [host1] => {
    "msg": "Virtual host: centos-main.site"
}

TASK [webserver : Test destination dir] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:31 +0300 (0:00:00.043)       0:00:25.971 ********** 
ok: [host1]

TASK [webserver : Add index.html] ********************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:31 +0300 (0:00:00.739)       0:00:26.711 ********** 
ok: [host1]

TASK [webserver : Add conf] **************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:33 +0300 (0:00:01.317)       0:00:28.028 ********** 
ok: [host1]

TASK [webserver : Debug] *****************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:34 +0300 (0:00:01.306)       0:00:29.335 ********** 
ok: [host1] => {
    "msg": "Virtual host: centos-old.site"
}

TASK [webserver : Restart nginx centos] **************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:34 +0300 (0:00:00.076)       0:00:29.411 ********** 
changed: [host1]

TASK [webserver : Nginx. Enable firewall port] *******************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:35 +0300 (0:00:01.183)       0:00:30.595 ********** 
ok: [host1]

TASK [webserver : Nginx. reload service firewalld] ***************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:36 +0300 (0:00:01.174)       0:00:31.769 ********** 
changed: [host1]

TASK [webserver : Nginx. Test centos] ****************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:38 +0300 (0:00:01.647)       0:00:33.416 ********** 
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/test.yaml for host1
included: /home/user/edu/devops_202205/sa.it-academy.by/Artsiom_Dziavitski/07.Ansible_cruise/manifests/roles/webserver/tasks/test.yaml for host1

TASK [webserver : Check content to the sites] ********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:38 +0300 (0:00:00.081)       0:00:33.498 ********** 
ok: [host1]

TASK [webserver : Debug test] ************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:39 +0300 (0:00:00.835)       0:00:34.333 ********** 
ok: [host1] => {
    "msg": "Virtual host: centos-main.site"
}

TASK [webserver : Check content to the sites] ********************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:39 +0300 (0:00:00.045)       0:00:34.379 ********** 
ok: [host1]

TASK [webserver : Debug test] ************************************************************************************************************************************************************************************
Tuesday 14 June 2022  04:23:40 +0300 (0:00:00.848)       0:00:35.227 ********** 
ok: [host1] => {
    "msg": "Virtual host: centos-old.site"
}

PLAY RECAP *******************************************************************************************************************************************************************************************************
host1                      : ok=24   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
host2                      : ok=21   changed=1    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

Tuesday 14 June 2022  04:23:40 +0300 (0:00:00.030)       0:00:35.257 ********** 
=============================================================================== 
Gathering Facts ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 2.85s
webserver : Nginx. Install packages ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- 2.84s
webserver : Add conf -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.83s
webserver : Nginx. reload service firewalld --------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.65s
webserver : Add index.html -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.63s
webserver : Nginx. Enable and start service --------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.39s
webserver : Add index.html -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.37s
webserver : Add conf -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.32s
webserver : Add index.html -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.32s
webserver : Add conf -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.31s
webserver : Add conf -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.30s
webserver : Add index.html -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.29s
webserver : Restart nginx ubuntu -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.19s
webserver : Restart nginx centos -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.18s
webserver : Nginx. Enable firewall port ------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.17s
webserver : Install EPEL Repo ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.15s
webserver : Test destination dir -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.07s
webserver : Nginx. Install packages ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.05s
webserver : Check content to the sites -------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.92s
webserver : Check content to the sites -------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.91s
```
